(import [numpy [*]]
        [svg [*]])


(defn test_list-add []
  (assert (all (= (list-add [1 2] [3 4]) [4 6]))))

(defn test_lines2beziers []
  (assert (all (= (around (lines2beziers [[[7.1387396 1.0595]
                                           [7.1387396 4.4387]]
                                          [[7.1387396 4.4387]
                                           [14.2774792 5.4982]]]) 3)
                  [[[7.139 1.060] [7.139 2.186] [ 7.139 3.312] [ 7.139 4.439]]
                   [[7.139 4.439] [9.518 4.792] [11.898 5.145] [14.277 5.498]]])))            )

(defn test_ptlist2matrix []
  (let [[args {"points" [[0.33619 -0.8761] [0.83433 -2.6761001] [1.10697998 -4.0000001]
                         [0.27266 -1.3239] [0.72931 -3.5321] [1.01479 -4.9071]
                         [0.76004 -3.6607] [2.48095 -3.05079996] [2.48095 0.8792]]
               "offset"  [0.16338942 11.341288]
               "slicing" 3
               "is_absolute" False} ]]
    (all (= (around (apply ptlist2matrix [] args) 3)
            [[[0.163 11.341] [0.500 10.465] [0.998  8.665] [1.270 7.341]]
             [[1.270  7.341] [1.543  6.017] [2.000  3.809] [2.285 2.434]]
             [[2.285  2.434] [3.045 -1.227] [4.766 -0.617] [4.766 3.313]]]))))


(defn test_path2matrix []
  (setv str "m 0.16338942,11.341288 c 0.33619,-0.8761 0.83433,-2.6761001 1.10697998,-4.0000001 0.27266,-1.3239 0.72931,-3.5321 1.01479,-4.9071 0.76004,-3.6607 2.48095,-3.05079996 2.48095,0.8792 l 0,3.3792 7.1387396,1.0595 c 11.00777,1.6338 11.36723,3.4916001 0.55164,2.8510001 -7.0567496,-0.4179 -8.9185296,-0.2379 -9.3569896,0.9047 -0.30105,0.7845 -1.22237,1.4264 -2.04737,1.4264 -0.96136998,0 -1.28050998,-0.572 -0.88873998,-1.5929 z")
  (assert (all (= (around (list (take 4 (first (list (path2matrix str))))) 3)
                  [[[0.163 11.341] [0.500 10.465] [0.998  8.665] [1.270 7.341]]
                   [[1.270  7.341] [1.543  6.017] [2.000  3.809] [2.285 2.434]]
                   [[2.285  2.434] [3.045 -1.227] [4.766 -0.617] [4.766 3.313]]
                   [[4.766  3.313] [4.766  4.440] [4.766  5.566] [4.766 6.693]]]))))


(defn test_matrix2path []
  (assert (= (matrix2path [[[0.163 11.341] [0.500 10.465] [0.998  8.665] [1.270 7.341]]
                           [[1.270  7.341] [1.543  6.017] [2.000  3.809] [2.285 2.434]]
                           [[2.285  2.434] [3.045 -1.227] [4.766 -0.617] [4.766 3.313]]
                           [[4.766  3.313] [4.766  4.440] [4.766  5.566] [4.766 6.693]]])
             "M0.163,11.341 C0.5,10.465 0.998,8.665 1.27,7.341 C1.543,6.017 2.0,3.809 2.285,2.434 C3.045,-1.227 4.766,-0.617 4.766,3.313 C4.766,4.44 4.766,5.566 4.766,6.693")))
